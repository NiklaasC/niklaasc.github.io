<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF8">
		<title>Rabbit&middot;Rabbit</title>
		<script src="./lib/phaser.js"></script>
		<style>
			html, body, div { display: block; margin: 0px; padding: 0px; }
			body { background: #cccccc; }
			div { width: 400px; margin: 0px auto; margin-top: 50px; }
		</style>
	</head>
	<body>
		<div id="phaser-game"></div>
		<script>

var game = new Phaser.Game(400,400, Phaser.AUTO, "phaser-game", { preload: preload, create: create, update: update });

function preload() {
	game.load.image("sky", "./res/sky.png");
	game.load.tilemap("map", "./res/map.json", null, Phaser.Tilemap.TILED_JSON);
	game.load.image("block", "./res/block.png", 16, 16);
	game.load.spritesheet("bun", "./res/bun.png", 12,28);
}

var map;
var layer;
var player;
var cursors;

function create() {
	game.physics.startSystem(Phaser.Physics.ARCADE);
	
	game.add.sprite(0,0, "sky");
	
	map = game.add.tilemap("map");
	map.addTilesetImage("block");
	
	layer = map.createLayer("Tile Layer 1");
	//  Basically this sets EVERY SINGLE tile to fully collide on all faces
	//	phaser.io/examples/v2/tilemaps/sci-fly
	map.setCollision(1);
	layer.resizeWorld();
	
	player = game.add.sprite(200,300, "bun");
	
	game.physics.arcade.enable(player);
	player.body.bounce.y = 0.2;
	player.body.gravity.y = 600;
	player.body.collideWorldBounds = true;
	
	player.animations.add("left", [0,1,2,3], 8, true);
	player.animations.add("right", [5,6,7,8], 8, true);
	player.animations.add("stand", [4], 8, true);
	
	cursors = game.input.keyboard.createCursorKeys();	
}

function update() {
	//	Collide before input, otherwise player collisions with the map can't be detected!
	game.physics.arcade.collide(player, layer);
	
	player.body.velocity.x = 0;
	
	if (cursors.left.isDown) {
		player.body.velocity.x = -150;
		player.animations.play("left");
	} else if (cursors.right.isDown) {
		player.body.velocity.x = 150;
		player.animations.play("right");
	} else {
		player.animations.play("stand");
	}
	
	if (cursors.up.isDown) {
		if (player.body.onFloor()) { //...was player.body.touching.down
			player.body.velocity.y = -300;
		}
	}
}

		</script>
	</body>
</html>
